!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t():"function"==typeof define&&define.amd?define(t):(e="undefined"!=typeof globalThis?globalThis:e||self).Kaca=t()}(this,(function(){"use strict";function e(e,r,n){return r&&function(e,r){for(var n=0;n<r.length;n++){var i=r[n];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,t(i.key),i)}}(e.prototype,r),Object.defineProperty(e,"prototype",{writable:!1}),e}function t(e){var t=function(e,t){if("object"!=typeof e||!e)return e;var r=e[Symbol.toPrimitive];if(void 0!==r){var n=r.call(e,t);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(e)}(e,"string");return"symbol"==typeof t?t:t+""}var r;function n(e){return e.nodeType===e.ELEMENT_NODE}!function(e){e[e.Document=0]="Document",e[e.DocumentType=1]="DocumentType",e[e.Element=2]="Element",e[e.Text=3]="Text",e[e.CDATA=4]="CDATA",e[e.Comment=5]="Comment"}(r||(r={}));var i=function(){function e(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}return e.prototype.getId=function(e){var t;if(!e)return-1;var r=null===(t=this.getMeta(e))||void 0===t?void 0:t.id;return null!=r?r:-1},e.prototype.getNode=function(e){return this.idNodeMap.get(e)||null},e.prototype.getIds=function(){return Array.from(this.idNodeMap.keys())},e.prototype.getMeta=function(e){return this.nodeMetaMap.get(e)||null},e.prototype.removeNodeFromMap=function(e){var t=this,r=this.getId(e);this.idNodeMap.delete(r),e.childNodes&&e.childNodes.forEach((function(e){return t.removeNodeFromMap(e)}))},e.prototype.has=function(e){return this.idNodeMap.has(e)},e.prototype.hasNode=function(e){return this.nodeMetaMap.has(e)},e.prototype.add=function(e,t){var r=t.id;this.idNodeMap.set(r,e),this.nodeMetaMap.set(e,t)},e.prototype.replace=function(e,t){var r=this.getNode(e);if(r){var n=this.nodeMetaMap.get(r);n&&this.nodeMetaMap.set(t,n)}this.idNodeMap.set(e,t)},e.prototype.reset=function(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap},e}(),o=/\/\*[^*]*\*+([^/*][^*]*\*+)*\//g;function a(e,t){void 0===t&&(t={});var r=1,n=1;function i(e){var t=e.match(/\n/g);t&&(r+=t.length);var i=e.lastIndexOf("\n");n=-1===i?n+e.length:e.length-i}function a(){var e={line:r,column:n};return function(t){return t.position=new u(e),g(),t}}var u=function(e){this.start=e,this.end={line:r,column:n},this.source=t.source};u.prototype.content=e;var f=[];function l(i){var o=new Error("".concat(t.source||"",":").concat(r,":").concat(n,": ").concat(i));if(o.reason=i,o.filename=t.source,o.line=r,o.column=n,o.source=e,!t.silent)throw o;f.push(o)}function p(){return m(/^{\s*/)}function d(){return m(/^}/)}function h(){var t,r=[];for(g(),v(r);e.length&&"}"!==e.charAt(0)&&(t=A()||D());)!1!==t&&(r.push(t),v(r));return r}function m(t){var r=t.exec(e);if(r){var n=r[0];return i(n),e=e.slice(n.length),r}}function g(){m(/^\s*/)}function v(e){var t;for(void 0===e&&(e=[]);t=y();)!1!==t&&e.push(t),t=y();return e}function y(){var t=a();if("/"===e.charAt(0)&&"*"===e.charAt(1)){for(var r=2;""!==e.charAt(r)&&("*"!==e.charAt(r)||"/"!==e.charAt(r+1));)++r;if(r+=2,""===e.charAt(r-1))return l("End of comment missing");var o=e.slice(2,r-2);return n+=2,i(o),e=e.slice(r),n+=2,t({type:"comment",comment:o})}}function b(){var e=m(/^([^{]+)/);if(e)return s(e[0]).replace(/\/\*([^*]|[\r\n]|(\*+([^*/]|[\r\n])))*\*\/+/g,"").replace(/"(?:\\"|[^"])*"|'(?:\\'|[^'])*'/g,(function(e){return e.replace(/,/g,"â€Œ")})).split(/\s*(?![^(]*\)),\s*/).map((function(e){return e.replace(/\u200C/g,",")}))}function w(){var e=a(),t=m(/^(\*?[-#\/\*\\\w]+(\[[0-9a-z_-]+\])?)\s*/);if(t){var r=s(t[0]);if(!m(/^:\s*/))return l("property missing ':'");var n=m(/^((?:'(?:\\'|.)*?'|"(?:\\"|.)*?"|\([^\)]*?\)|[^};])+)/),i=e({type:"declaration",property:r.replace(o,""),value:n?s(n[0]).replace(o,""):""});return m(/^[;\s]*/),i}}function C(){var e,t=[];if(!p())return l("missing '{'");for(v(t);e=w();)!1!==e&&(t.push(e),v(t)),e=w();return d()?t:l("missing '}'")}function M(){for(var e,t=[],r=a();e=m(/^((\d+\.\d+|\.\d+|\d+)%?|[a-z]+)\s*/);)t.push(e[1]),m(/^,\s*/);if(t.length)return r({type:"keyframe",values:t,declarations:C()})}var T,N=x("import"),k=x("charset"),E=x("namespace");function x(e){var t=new RegExp("^@"+e+"\\s*([^;]+);");return function(){var r=a(),n=m(t);if(n){var i={type:e};return i[e]=n[1].trim(),r(i)}}}function A(){if("@"===e[0])return function(){var e=a(),t=m(/^@([-\w]+)?keyframes\s*/);if(t){var r=t[1];if(!(t=m(/^([-\w]+)\s*/)))return l("@keyframes missing name");var n,i=t[1];if(!p())return l("@keyframes missing '{'");for(var o=v();n=M();)o.push(n),o=o.concat(v());return d()?e({type:"keyframes",name:i,vendor:r,keyframes:o}):l("@keyframes missing '}'")}}()||function(){var e=a(),t=m(/^@media *([^{]+)/);if(t){var r=s(t[1]);if(!p())return l("@media missing '{'");var n=v().concat(h());return d()?e({type:"media",media:r,rules:n}):l("@media missing '}'")}}()||function(){var e=a(),t=m(/^@custom-media\s+(--[^\s]+)\s*([^{;]+);/);if(t)return e({type:"custom-media",name:s(t[1]),media:s(t[2])})}()||function(){var e=a(),t=m(/^@supports *([^{]+)/);if(t){var r=s(t[1]);if(!p())return l("@supports missing '{'");var n=v().concat(h());return d()?e({type:"supports",supports:r,rules:n}):l("@supports missing '}'")}}()||N()||k()||E()||function(){var e=a(),t=m(/^@([-\w]+)?document *([^{]+)/);if(t){var r=s(t[1]),n=s(t[2]);if(!p())return l("@document missing '{'");var i=v().concat(h());return d()?e({type:"document",document:n,vendor:r,rules:i}):l("@document missing '}'")}}()||function(){var e=a();if(m(/^@page */)){var t=b()||[];if(!p())return l("@page missing '{'");for(var r,n=v();r=w();)n.push(r),n=n.concat(v());return d()?e({type:"page",selectors:t,declarations:n}):l("@page missing '}'")}}()||function(){var e=a();if(m(/^@host\s*/)){if(!p())return l("@host missing '{'");var t=v().concat(h());return d()?e({type:"host",rules:t}):l("@host missing '}'")}}()||function(){var e=a();if(m(/^@font-face\s*/)){if(!p())return l("@font-face missing '{'");for(var t,r=v();t=w();)r.push(t),r=r.concat(v());return d()?e({type:"font-face",declarations:r}):l("@font-face missing '}'")}}()}function D(){var e=a(),t=b();return t?(v(),e({type:"rule",selectors:t,declarations:C()})):l("selector missing")}return c((T=h(),{type:"stylesheet",stylesheet:{source:t.source,rules:T,parsingErrors:f}}))}function s(e){return e?e.replace(/^\s+|\s+$/g,""):""}function c(e,t){for(var r=e&&"string"==typeof e.type,n=r?e:t,i=0,o=Object.keys(e);i<o.length;i++){var a=e[o[i]];Array.isArray(a)?a.forEach((function(e){c(e,n)})):a&&"object"==typeof a&&c(a,n)}return r&&Object.defineProperty(e,"parent",{configurable:!0,writable:!0,enumerable:!1,value:t||null}),e}var u={script:"noscript",altglyph:"altGlyph",altglyphdef:"altGlyphDef",altglyphitem:"altGlyphItem",animatecolor:"animateColor",animatemotion:"animateMotion",animatetransform:"animateTransform",clippath:"clipPath",feblend:"feBlend",fecolormatrix:"feColorMatrix",fecomponenttransfer:"feComponentTransfer",fecomposite:"feComposite",feconvolvematrix:"feConvolveMatrix",fediffuselighting:"feDiffuseLighting",fedisplacementmap:"feDisplacementMap",fedistantlight:"feDistantLight",fedropshadow:"feDropShadow",feflood:"feFlood",fefunca:"feFuncA",fefuncb:"feFuncB",fefuncg:"feFuncG",fefuncr:"feFuncR",fegaussianblur:"feGaussianBlur",feimage:"feImage",femerge:"feMerge",femergenode:"feMergeNode",femorphology:"feMorphology",feoffset:"feOffset",fepointlight:"fePointLight",fespecularlighting:"feSpecularLighting",fespotlight:"feSpotLight",fetile:"feTile",feturbulence:"feTurbulence",foreignobject:"foreignObject",glyphref:"glyphRef",lineargradient:"linearGradient",radialgradient:"radialGradient"};var f=/([^\\]):hover/,l=new RegExp(f.source,"g");function p(e,t){var r=null==t?void 0:t.stylesWithHoverClass.get(e);if(r)return r;var n=a(e,{silent:!0});if(!n.stylesheet)return e;var i=[];if(n.stylesheet.rules.forEach((function(e){"selectors"in e&&(e.selectors||[]).forEach((function(e){f.test(e)&&i.push(e)}))})),0===i.length)return e;var o=new RegExp(i.filter((function(e,t){return i.indexOf(e)===t})).sort((function(e,t){return t.length-e.length})).map((function(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")})).join("|"),"g"),s=e.replace(o,(function(e){var t=e.replace(l,"$1.\\:hover");return"".concat(e,", ").concat(t)}));return null==t||t.stylesWithHoverClass.set(e,s),s}function d(e,t){var n=t.doc,i=t.hackCss,o=t.cache;switch(e.type){case r.Document:return n.implementation.createDocument(null,"",null);case r.DocumentType:return n.implementation.createDocumentType(e.name||"html",e.publicId,e.systemId);case r.Element:var a,s=function(e){var t=u[e.tagName]?u[e.tagName]:e.tagName;return"link"===t&&e.attributes._cssText&&(t="style"),t}(e);a=e.isSVG?n.createElementNS("http://www.w3.org/2000/svg",s):n.createElement(s);var c={};for(var f in e.attributes)if(Object.prototype.hasOwnProperty.call(e.attributes,f)){var l=e.attributes[f];if("option"!==s||"selected"!==f||!1!==l)if(!0===l&&(l=""),f.startsWith("rr_"))c[f]=l;else{var d="textarea"===s&&"value"===f,h="style"===s&&"_cssText"===f;if(h&&i&&"string"==typeof l&&(l=p(l,o)),!d&&!h||"string"!=typeof l)try{if(e.isSVG&&"xlink:href"===f)a.setAttributeNS("http://www.w3.org/1999/xlink",f,l.toString());else if("onload"===f||"onclick"===f||"onmouse"===f.substring(0,7))a.setAttribute("_"+f,l.toString());else{if("meta"===s&&"Content-Security-Policy"===e.attributes["http-equiv"]&&"content"===f){a.setAttribute("csp-content",l.toString());continue}"link"===s&&"preload"===e.attributes.rel&&"script"===e.attributes.as||"link"===s&&"prefetch"===e.attributes.rel&&"string"==typeof e.attributes.href&&e.attributes.href.endsWith(".js")||("img"===s&&e.attributes.srcset&&e.attributes.rr_dataURL?a.setAttribute("rrweb-original-srcset",e.attributes.srcset):a.setAttribute(f,l.toString()))}}catch(e){}else{for(var m=n.createTextNode(l),g=0,v=Array.from(a.childNodes);g<v.length;g++){var y=v[g];y.nodeType===a.TEXT_NODE&&a.removeChild(y)}a.appendChild(m)}}}var b=function(t){var r=c[t];if("canvas"===s&&"rr_dataURL"===t){var n=document.createElement("img");n.onload=function(){var e=a.getContext("2d");e&&e.drawImage(n,0,0,n.width,n.height)},n.src=r.toString(),a.RRNodeType&&(a.rr_dataURL=r.toString())}else if("img"===s&&"rr_dataURL"===t){var i=a;i.currentSrc.startsWith("data:")||(i.setAttribute("rrweb-original-src",e.attributes.src),i.src=r.toString())}if("rr_width"===t)a.style.width=r.toString();else if("rr_height"===t)a.style.height=r.toString();else if("rr_mediaCurrentTime"===t&&"number"==typeof r)a.currentTime=r;else if("rr_mediaState"===t)switch(r){case"played":a.play().catch((function(e){return console.warn("media playback error",e)}));break;case"paused":a.pause()}};for(var w in c)b(w);if(e.isShadowHost)if(a.shadowRoot)for(;a.shadowRoot.firstChild;)a.shadowRoot.removeChild(a.shadowRoot.firstChild);else a.attachShadow({mode:"open"});return a;case r.Text:return n.createTextNode(e.isStyle&&i?p(e.textContent,o):e.textContent);case r.CDATA:return n.createCDATASection(e.textContent);case r.Comment:return n.createComment(e.textContent);default:return null}}function h(e,t){var i=t.doc,o=t.mirror,a=t.skipChild,s=void 0!==a&&a,c=t.hackCss,u=void 0===c||c,f=t.afterAppend,l=t.cache,p=d(e,{doc:i,hackCss:u,cache:l});if(!p)return null;if(e.rootId&&o.getNode(e.rootId)!==i&&o.replace(e.rootId,i),e.type===r.Document&&(i.close(),i.open(),"BackCompat"===e.compatMode&&e.childNodes&&e.childNodes[0].type!==r.DocumentType&&(e.childNodes[0].type===r.Element&&"xmlns"in e.childNodes[0].attributes&&"http://www.w3.org/1999/xhtml"===e.childNodes[0].attributes.xmlns?i.write('<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "">'):i.write('<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN" "">')),p=i),o.add(p,e),(e.type===r.Document||e.type===r.Element)&&!s)for(var m=0,g=e.childNodes;m<g.length;m++){var v=g[m],y=h(v,{doc:i,mirror:o,skipChild:!1,hackCss:u,afterAppend:f,cache:l});y?(v.isShadow&&n(p)&&p.shadowRoot?p.shadowRoot.appendChild(y):p.appendChild(y),f&&f(y,v.id)):console.warn("Failed to rebuild",v)}return p}function m(e,t){var n=t.doc,o=t.onVisit,a=t.hackCss,s=void 0===a||a,c=t.afterAppend,u=t.cache,f=t.mirror,l=void 0===f?new i:f,p=h(e,{doc:n,mirror:l,skipChild:!1,hackCss:s,afterAppend:c,cache:u});return function(e,t){for(var r=0,n=e.getIds();r<n.length;r++){var i=n[r];e.has(i)&&t(e.getNode(i))}}(l,(function(e){o&&o(e),function(e,t){var n=t.getMeta(e);if((null==n?void 0:n.type)===r.Element){var i=e;for(var o in n.attributes)if(Object.prototype.hasOwnProperty.call(n.attributes,o)&&o.startsWith("rr_")){var a=n.attributes[o];"rr_scrollLeft"===o&&(i.scrollLeft=a),"rr_scrollTop"===o&&(i.scrollTop=a)}}}(e,l)})),p}return new(function(){return e((function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}),[{key:"rebuild",value:function(e){m(e,{doc:window.document})}}])}())}));
