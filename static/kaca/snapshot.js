!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):(t="undefined"!=typeof globalThis?globalThis:t||self).Kaca=e()}(this,(function(){"use strict";function e(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,n=Array(e);r<e;r++)n[r]=t[r];return n}function r(t,e,r,n,o,a,i){try{var s=t[a](i),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(n,o)}function n(t){return function(){var e=this,n=arguments;return new Promise((function(o,a){var i=t.apply(e,n);function s(t){r(i,o,a,s,c,"next",t)}function c(t){r(i,o,a,s,c,"throw",t)}s(void 0)}))}}function o(t,e,r){return e&&function(t,e){for(var r=0;r<e.length;r++){var n=e[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(t,l(n.key),n)}}(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t}function a(t,e){var r="undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(!r){if(Array.isArray(t)||(r=d(t))||e){r&&(t=r);var n=0,o=function(){};return{s:o,n:function(){return n>=t.length?{done:!0}:{done:!1,value:t[n++]}},e:function(t){throw t},f:o}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}var a,i=!0,s=!1;return{s:function(){r=r.call(t)},n:function(){var t=r.next();return i=t.done,t},e:function(t){s=!0,a=t},f:function(){try{i||null==r.return||r.return()}finally{if(s)throw a}}}}function i(t,e,r){return(e=l(e))in t?Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}):t[e]=r,t}function s(t,e){var r=Object.keys(t);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(t);e&&(n=n.filter((function(e){return Object.getOwnPropertyDescriptor(t,e).enumerable}))),r.push.apply(r,n)}return r}function c(){c=function(){return e};var t,e={},r=Object.prototype,n=r.hasOwnProperty,o=Object.defineProperty||function(t,e,r){t[e]=r.value},a="function"==typeof Symbol?Symbol:{},i=a.iterator||"@@iterator",s=a.asyncIterator||"@@asyncIterator",u=a.toStringTag||"@@toStringTag";function l(t,e,r){return Object.defineProperty(t,e,{value:r,enumerable:!0,configurable:!0,writable:!0}),t[e]}try{l({},"")}catch(t){l=function(t,e,r){return t[e]=r}}function d(t,e,r,n){var a=e&&e.prototype instanceof g?e:g,i=Object.create(a.prototype),s=new M(n||[]);return o(i,"_invoke",{value:E(t,r,s)}),i}function f(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var p="suspendedStart",h="suspendedYield",m="executing",v="completed",y={};function g(){}function b(){}function k(){}var w={};l(w,i,(function(){return this}));var S=Object.getPrototypeOf,T=S&&S(S(_([])));T&&T!==r&&n.call(T,i)&&(w=T);var x=k.prototype=g.prototype=Object.create(w);function L(t){["next","throw","return"].forEach((function(e){l(t,e,(function(t){return this._invoke(e,t)}))}))}function O(t,e){function r(o,a,i,s){var c=f(t[o],t,a);if("throw"!==c.type){var u=c.arg,l=u.value;return l&&"object"==typeof l&&n.call(l,"__await")?e.resolve(l.__await).then((function(t){r("next",t,i,s)}),(function(t){r("throw",t,i,s)})):e.resolve(l).then((function(t){u.value=t,i(u)}),(function(t){return r("throw",t,i,s)}))}s(c.arg)}var a;o(this,"_invoke",{value:function(t,n){function o(){return new e((function(e,o){r(t,n,e,o)}))}return a=a?a.then(o,o):o()}})}function E(e,r,n){var o=p;return function(a,i){if(o===m)throw Error("Generator is already running");if(o===v){if("throw"===a)throw i;return{value:t,done:!0}}for(n.method=a,n.arg=i;;){var s=n.delegate;if(s){var c=I(s,n);if(c){if(c===y)continue;return c}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(o===p)throw o=v,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);o=m;var u=f(e,r,n);if("normal"===u.type){if(o=n.done?v:h,u.arg===y)continue;return{value:u.arg,done:n.done}}"throw"===u.type&&(o=v,n.method="throw",n.arg=u.arg)}}}function I(e,r){var n=r.method,o=e.iterator[n];if(o===t)return r.delegate=null,"throw"===n&&e.iterator.return&&(r.method="return",r.arg=t,I(e,r),"throw"===r.method)||"return"!==n&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+n+"' method")),y;var a=f(o,e.iterator,r.arg);if("throw"===a.type)return r.method="throw",r.arg=a.arg,r.delegate=null,y;var i=a.arg;return i?i.done?(r[e.resultName]=i.value,r.next=e.nextLoc,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,y):i:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,y)}function C(t){var e={tryLoc:t[0]};1 in t&&(e.catchLoc=t[1]),2 in t&&(e.finallyLoc=t[2],e.afterLoc=t[3]),this.tryEntries.push(e)}function N(t){var e=t.completion||{};e.type="normal",delete e.arg,t.completion=e}function M(t){this.tryEntries=[{tryLoc:"root"}],t.forEach(C,this),this.reset(!0)}function _(e){if(e||""===e){var r=e[i];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var o=-1,a=function r(){for(;++o<e.length;)if(n.call(e,o))return r.value=e[o],r.done=!1,r;return r.value=t,r.done=!0,r};return a.next=a}}throw new TypeError(typeof e+" is not iterable")}return b.prototype=k,o(x,"constructor",{value:k,configurable:!0}),o(k,"constructor",{value:b,configurable:!0}),b.displayName=l(k,u,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===b||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,k):(t.__proto__=k,l(t,u,"GeneratorFunction")),t.prototype=Object.create(x),t},e.awrap=function(t){return{__await:t}},L(O.prototype),l(O.prototype,s,(function(){return this})),e.AsyncIterator=O,e.async=function(t,r,n,o,a){void 0===a&&(a=Promise);var i=new O(d(t,r,n,o),a);return e.isGeneratorFunction(r)?i:i.next().then((function(t){return t.done?t.value:i.next()}))},L(x),l(x,u,"Generator"),l(x,i,(function(){return this})),l(x,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var n in e)r.push(n);return r.reverse(),function t(){for(;r.length;){var n=r.pop();if(n in e)return t.value=n,t.done=!1,t}return t.done=!0,t}},e.values=_,M.prototype={constructor:M,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(N),!e)for(var r in this)"t"===r.charAt(0)&&n.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0].completion;if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function o(n,o){return s.type="throw",s.arg=e,r.next=n,o&&(r.method="next",r.arg=t),!!o}for(var a=this.tryEntries.length-1;a>=0;--a){var i=this.tryEntries[a],s=i.completion;if("root"===i.tryLoc)return o("end");if(i.tryLoc<=this.prev){var c=n.call(i,"catchLoc"),u=n.call(i,"finallyLoc");if(c&&u){if(this.prev<i.catchLoc)return o(i.catchLoc,!0);if(this.prev<i.finallyLoc)return o(i.finallyLoc)}else if(c){if(this.prev<i.catchLoc)return o(i.catchLoc,!0)}else{if(!u)throw Error("try statement without catch or finally");if(this.prev<i.finallyLoc)return o(i.finallyLoc)}}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var o=this.tryEntries[r];if(o.tryLoc<=this.prev&&n.call(o,"finallyLoc")&&this.prev<o.finallyLoc){var a=o;break}}a&&("break"===t||"continue"===t)&&a.tryLoc<=e&&e<=a.finallyLoc&&(a=null);var i=a?a.completion:{};return i.type=t,i.arg=e,a?(this.method="next",this.next=a.finallyLoc,y):this.complete(i)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),y},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.finallyLoc===t)return this.complete(r.completion,r.afterLoc),N(r),y}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r.tryLoc===t){var n=r.completion;if("throw"===n.type){var o=n.arg;N(r)}return o}}throw Error("illegal catch attempt")},delegateYield:function(e,r,n){return this.delegate={iterator:_(e),resultName:r,nextLoc:n},"next"===this.method&&(this.arg=t),y}},e}function u(t,e){return function(t){if(Array.isArray(t))return t}(t)||function(t,e){var r=null==t?null:"undefined"!=typeof Symbol&&t[Symbol.iterator]||t["@@iterator"];if(null!=r){var n,o,a,i,s=[],c=!0,u=!1;try{if(a=(r=r.call(t)).next,0===e);else for(;!(c=(n=a.call(r)).done)&&(s.push(n.value),s.length!==e);c=!0);}catch(t){u=!0,o=t}finally{try{if(!c&&null!=r.return&&(i=r.return(),Object(i)!==i))return}finally{if(u)throw o}}return s}}(t,e)||d(t,e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function l(t){var e=function(t,e){if("object"!=typeof t||!t)return t;var r=t[Symbol.toPrimitive];if(void 0!==r){var n=r.call(t,e);if("object"!=typeof n)return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t,"string");return"symbol"==typeof e?e:e+""}function d(t,r){if(t){if("string"==typeof t)return e(t,r);var n={}.toString.call(t).slice(8,-1);return"Object"===n&&t.constructor&&(n=t.constructor.name),"Map"===n||"Set"===n?Array.from(t):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?e(t,r):void 0}}var f;function p(t){return"[object ShadowRoot]"===Object.prototype.toString.call(t)}function h(t){try{var e=t.rules||t.cssRules;return e?((r=Array.from(e).map(m).join("")).includes(" background-clip: text;")&&!r.includes(" -webkit-background-clip: text;")&&(r=r.replace(" background-clip: text;"," -webkit-background-clip: text; background-clip: text;")),r):null}catch(t){return null}var r}function m(t){var e=t.cssText;if(function(t){return"styleSheet"in t}(t))try{e=h(t.styleSheet)||e}catch(t){}return e}!function(t){t[t.Document=0]="Document",t[t.DocumentType=1]="DocumentType",t[t.Element=2]="Element",t[t.Text=3]="Text",t[t.CDATA=4]="CDATA",t[t.Comment=5]="Comment"}(f||(f={}));var v=function(){function t(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap}return t.prototype.getId=function(t){var e;if(!t)return-1;var r=null===(e=this.getMeta(t))||void 0===e?void 0:e.id;return null!=r?r:-1},t.prototype.getNode=function(t){return this.idNodeMap.get(t)||null},t.prototype.getIds=function(){return Array.from(this.idNodeMap.keys())},t.prototype.getMeta=function(t){return this.nodeMetaMap.get(t)||null},t.prototype.removeNodeFromMap=function(t){var e=this,r=this.getId(t);this.idNodeMap.delete(r),t.childNodes&&t.childNodes.forEach((function(t){return e.removeNodeFromMap(t)}))},t.prototype.has=function(t){return this.idNodeMap.has(t)},t.prototype.hasNode=function(t){return this.nodeMetaMap.has(t)},t.prototype.add=function(t,e){var r=e.id;this.idNodeMap.set(r,t),this.nodeMetaMap.set(t,e)},t.prototype.replace=function(t,e){var r=this.getNode(t);if(r){var n=this.nodeMetaMap.get(r);n&&this.nodeMetaMap.set(e,n)}this.idNodeMap.set(t,e)},t.prototype.reset=function(){this.idNodeMap=new Map,this.nodeMetaMap=new WeakMap},t}();var y="__rrweb_original__";var g,b,k=1,w=new RegExp("[^a-z0-9-_:]");var S=/url\((?:(')([^']*)'|(")(.*?)"|([^)]*))\)/gm,T=/^(?!www\.|(?:http|ftp)s?:\/\/|[A-Za-z]:\\|\/\/|#).*/,x=/^(data:)([^,]*),(.*)/i;function L(t,e){return(t||"").replace(S,(function(t,r,n,o,a,i){var s,c=n||a||i,u=r||o||"";if(!c)return t;if(!T.test(c))return"url(".concat(u).concat(c).concat(u,")");if(x.test(c))return"url(".concat(u).concat(c).concat(u,")");if("/"===c[0])return"url(".concat(u).concat((s=e,(s.indexOf("//")>-1?s.split("/").slice(0,3).join("/"):s.split("/")[0]).split("?")[0]+c)).concat(u,")");var l=e.split("/"),d=c.split("/");l.pop();for(var f=0,p=d;f<p.length;f++){var h=p[f];"."!==h&&(".."===h?l.pop():l.push(h))}return"url(".concat(u).concat(l.join("/")).concat(u,")")}))}var O=/^[^ \t\n\r\u000c]+/,E=/^[, \t\n\r\u000c]+/;function I(t,e){if(!e||""===e.trim())return e;var r=t.createElement("a");return r.href=e,r.href}function C(t){return Boolean("svg"===t.tagName||t.ownerSVGElement)}function N(){var t=document.createElement("a");return t.href="",t.href}function M(t,e,r,n){return"src"===r||"href"===r&&n&&("use"!==e||"#"!==n[0])||"xlink:href"===r&&n&&"#"!==n[0]?I(t,n):"background"!==r||!n||"table"!==e&&"td"!==e&&"th"!==e?"srcset"===r&&n?function(t,e){if(""===e.trim())return e;var r=0;function n(t){var n,o=t.exec(e.substring(r));return o?(n=o[0],r+=n.length,n):""}for(var o=[];n(E),!(r>=e.length);){var a=n(O);if(","===a.slice(-1))a=I(t,a.substring(0,a.length-1)),o.push(a);else{var i="";a=I(t,a);for(var s=!1;;){var c=e.charAt(r);if(""===c){o.push((a+i).trim());break}if(s)")"===c&&(s=!1);else{if(","===c){r+=1,o.push((a+i).trim());break}"("===c&&(s=!0)}i+=c,r+=1}}}return o.join(", ")}(t,n):"style"===r&&n?L(n,N()):"object"===e&&"data"===r&&n?I(t,n):n:I(t,n)}function _(t,e,r){if(!t)return!1;if(t.nodeType!==t.ELEMENT_NODE)return _(t.parentNode,e);for(var n=t.classList.length;n--;){var o=t.classList[n];if(e.test(o))return!0}return _(t.parentNode,e)}function j(t,e,r){var n=t.nodeType===t.ELEMENT_NODE?t:t.parentElement;if(null===n)return!1;if("string"==typeof e){if(n.classList.contains(e))return!0;if(n.closest(".".concat(e)))return!0}else if(_(n,e))return!0;if(r){if(n.matches(r))return!0;if(n.closest(r))return!0}return!1}function D(t,e){var r=e.doc,n=e.mirror,o=e.blockClass,a=e.blockSelector,i=e.maskTextClass,s=e.maskTextSelector,c=e.inlineStylesheet,u=e.maskInputOptions,l=void 0===u?{}:u,d=e.maskTextFn,p=e.maskInputFn,m=e.dataURLOptions,v=void 0===m?{}:m,k=e.inlineImages,S=e.recordCanvas,T=e.keepIframeSrcFn,x=e.newlyAddedElement,O=void 0!==x&&x,E=function(t,e){if(!e.hasNode(t))return;var r=e.getId(t);return 1===r?void 0:r}(r,n);switch(t.nodeType){case t.DOCUMENT_NODE:return"CSS1Compat"!==t.compatMode?{type:f.Document,childNodes:[],compatMode:t.compatMode}:{type:f.Document,childNodes:[]};case t.DOCUMENT_TYPE_NODE:return{type:f.DocumentType,name:t.name,publicId:t.publicId,systemId:t.systemId,rootId:E};case t.ELEMENT_NODE:return function(t,e){for(var r=e.doc,n=e.blockClass,o=e.blockSelector,a=e.inlineStylesheet,i=e.maskInputOptions,s=void 0===i?{}:i,c=e.maskInputFn,u=e.dataURLOptions,l=void 0===u?{}:u,d=e.inlineImages,p=e.recordCanvas,m=e.keepIframeSrcFn,v=e.newlyAddedElement,k=void 0!==v&&v,S=e.rootId,T=function(t,e,r){if("string"==typeof e){if(t.classList.contains(e))return!0}else for(var n=t.classList.length;n--;){var o=t.classList[n];if(e.test(o))return!0}return!!r&&t.matches(r)}(t,n,o),x=function(t){if(t instanceof HTMLFormElement)return"form";var e=t.tagName.toLowerCase().trim();return w.test(e)?"div":e}(t),O={},E=t.attributes.length,I=0;I<E;I++){var _=t.attributes[I];O[_.name]=M(r,x,_.name,_.value)}if("link"===x&&a){var j=Array.from(r.styleSheets).find((function(e){return e.href===t.href})),D=null;j&&(D=h(j)),D&&(delete O.rel,delete O.href,O._cssText=L(D,j.href))}if("style"===x&&t.sheet&&!(t.innerText||t.textContent||"").trim().length){(D=h(t.sheet))&&(O._cssText=L(D,N()))}if("input"===x||"textarea"===x||"select"===x){var F=t.value,A=t.checked;"radio"!==O.type&&"checkbox"!==O.type&&"submit"!==O.type&&"button"!==O.type&&F?O.value=function(t){var e=t.maskInputOptions,r=t.tagName,n=t.type,o=t.value,a=t.maskInputFn,i=o||"";return(e[r.toLowerCase()]||e[n])&&(i=a?a(i):"*".repeat(i.length)),i}({type:O.type,tagName:x,value:F,maskInputOptions:s,maskInputFn:c}):A&&(O.checked=A)}"option"===x&&(t.selected&&!s.select?O.selected=!0:delete O.selected);if("canvas"===x&&p)if("2d"===t.__context)(function(t){var e=t.getContext("2d");if(!e)return!0;for(var r=0;r<t.width;r+=50)for(var n=0;n<t.height;n+=50){var o=e.getImageData,a=y in o?o[y]:o;if(new Uint32Array(a.call(e,r,n,Math.min(50,t.width-r),Math.min(50,t.height-n)).data.buffer).some((function(t){return 0!==t})))return!1}return!0})(t)||(O.rr_dataURL=t.toDataURL(l.type,l.quality));else if(!("__context"in t)){var R=t.toDataURL(l.type,l.quality),U=document.createElement("canvas");U.width=t.width,U.height=t.height,R!==U.toDataURL(l.type,l.quality)&&(O.rr_dataURL=R)}if("img"===x&&d){g||(g=r.createElement("canvas"),b=g.getContext("2d"));var P=t,W=P.crossOrigin;P.crossOrigin="anonymous";var z=function(){try{g.width=P.naturalWidth,g.height=P.naturalHeight,b.drawImage(P,0,0),O.rr_dataURL=g.toDataURL(l.type,l.quality)}catch(t){console.warn("Cannot inline img src=".concat(P.currentSrc,"! Error: ").concat(t))}W?O.crossOrigin=W:P.removeAttribute("crossorigin")};P.complete&&0!==P.naturalWidth?z():P.onload=z}"audio"!==x&&"video"!==x||(O.rr_mediaState=t.paused?"paused":"played",O.rr_mediaCurrentTime=t.currentTime);k||(t.scrollLeft&&(O.rr_scrollLeft=t.scrollLeft),t.scrollTop&&(O.rr_scrollTop=t.scrollTop));if(T){var G=t.getBoundingClientRect(),q=G.width,B=G.height;O={class:O.class,rr_width:"".concat(q,"px"),rr_height:"".concat(B,"px")}}"iframe"!==x||m(O.src)||(t.contentDocument||(O.rr_src=O.src),delete O.src);return{type:f.Element,tagName:x,attributes:O,childNodes:[],isSVG:C(t)||void 0,needBlock:T,rootId:S}}(t,{doc:r,blockClass:o,blockSelector:a,inlineStylesheet:c,maskInputOptions:l,maskInputFn:p,dataURLOptions:v,inlineImages:k,recordCanvas:S,keepIframeSrcFn:T,newlyAddedElement:O,rootId:E});case t.TEXT_NODE:return function(t,e){var r,n=e.maskTextClass,o=e.maskTextSelector,a=e.maskTextFn,i=e.rootId,s=t.parentNode&&t.parentNode.tagName,c=t.textContent,u="STYLE"===s||void 0,l="SCRIPT"===s||void 0;if(u&&c){try{t.nextSibling||t.previousSibling||(null===(r=t.parentNode.sheet)||void 0===r?void 0:r.cssRules)&&(c=(d=t.parentNode.sheet).cssRules?Array.from(d.cssRules).map((function(t){return t.cssText||""})).join(""):"")}catch(e){console.warn("Cannot get CSS styles from text's parentNode. Error: ".concat(e),t)}c=L(c,N())}var d;l&&(c="SCRIPT_PLACEHOLDER");!u&&!l&&c&&j(t,n,o)&&(c=a?a(c):c.replace(/[\S]/g,"*"));return{type:f.Text,textContent:c||"",isStyle:u,rootId:i}}(t,{maskTextClass:i,maskTextSelector:s,maskTextFn:d,rootId:E});case t.CDATA_SECTION_NODE:return{type:f.CDATA,textContent:"",rootId:E};case t.COMMENT_NODE:return{type:f.Comment,textContent:t.textContent||"",rootId:E};default:return!1}}function F(t){return void 0===t?"":t.toLowerCase()}function A(t,e){var r,n=e.doc,o=e.mirror,a=e.blockClass,i=e.blockSelector,s=e.maskTextClass,c=e.maskTextSelector,u=e.skipChild,l=void 0!==u&&u,d=e.inlineStylesheet,h=void 0===d||d,m=e.maskInputOptions,v=void 0===m?{}:m,y=e.maskTextFn,g=e.maskInputFn,b=e.slimDOMOptions,w=e.dataURLOptions,S=void 0===w?{}:w,T=e.inlineImages,x=void 0!==T&&T,L=e.recordCanvas,O=void 0!==L&&L,E=e.onSerialize,I=e.onIframeLoad,C=e.iframeLoadTimeout,N=void 0===C?5e3:C,M=e.onStylesheetLoad,_=e.stylesheetLoadTimeout,j=void 0===_?5e3:_,R=e.keepIframeSrcFn,U=void 0===R?function(){return!1}:R,P=e.newlyAddedElement,W=void 0!==P&&P,z=e.preserveWhiteSpace,G=void 0===z||z,q=D(t,{doc:n,mirror:o,blockClass:a,blockSelector:i,maskTextClass:s,maskTextSelector:c,inlineStylesheet:h,maskInputOptions:v,maskTextFn:y,maskInputFn:g,dataURLOptions:S,inlineImages:x,recordCanvas:O,keepIframeSrcFn:U,newlyAddedElement:W});if(!q)return console.warn(t,"not serialized"),null;r=o.hasNode(t)?o.getId(t):!function(t,e){if(e.comment&&t.type===f.Comment)return!0;if(t.type===f.Element){if(e.script&&("script"===t.tagName||"link"===t.tagName&&"preload"===t.attributes.rel&&"script"===t.attributes.as||"link"===t.tagName&&"prefetch"===t.attributes.rel&&"string"==typeof t.attributes.href&&t.attributes.href.endsWith(".js")))return!0;if(e.headFavicon&&("link"===t.tagName&&"shortcut icon"===t.attributes.rel||"meta"===t.tagName&&(F(t.attributes.name).match(/^msapplication-tile(image|color)$/)||"application-name"===F(t.attributes.name)||"icon"===F(t.attributes.rel)||"apple-touch-icon"===F(t.attributes.rel)||"shortcut icon"===F(t.attributes.rel))))return!0;if("meta"===t.tagName){if(e.headMetaDescKeywords&&F(t.attributes.name).match(/^description|keywords$/))return!0;if(e.headMetaSocial&&(F(t.attributes.property).match(/^(og|twitter|fb):/)||F(t.attributes.name).match(/^(og|twitter):/)||"pinterest"===F(t.attributes.name)))return!0;if(e.headMetaRobots&&("robots"===F(t.attributes.name)||"googlebot"===F(t.attributes.name)||"bingbot"===F(t.attributes.name)))return!0;if(e.headMetaHttpEquiv&&void 0!==t.attributes["http-equiv"])return!0;if(e.headMetaAuthorship&&("author"===F(t.attributes.name)||"generator"===F(t.attributes.name)||"framework"===F(t.attributes.name)||"publisher"===F(t.attributes.name)||"progid"===F(t.attributes.name)||F(t.attributes.property).match(/^article:/)||F(t.attributes.property).match(/^product:/)))return!0;if(e.headMetaVerification&&("google-site-verification"===F(t.attributes.name)||"yandex-verification"===F(t.attributes.name)||"csrf-token"===F(t.attributes.name)||"p:domain_verify"===F(t.attributes.name)||"verify-v1"===F(t.attributes.name)||"verification"===F(t.attributes.name)||"shopify-checkout-api-token"===F(t.attributes.name)))return!0}}return!1}(q,b)&&(G||q.type!==f.Text||q.isStyle||q.textContent.replace(/^\s+|\s+$/gm,"").length)?k++:-2;var B=Object.assign(q,{id:r});if(o.add(t,B),-2===r)return null;E&&E(t);var H=!l;if(B.type===f.Element){H=H&&!B.needBlock,delete B.needBlock;var V=t.shadowRoot;V&&p(V)&&(B.isShadowHost=!0)}if((B.type===f.Document||B.type===f.Element)&&H){b.headWhitespace&&B.type===f.Element&&"head"===B.tagName&&(G=!1);for(var Y={doc:n,mirror:o,blockClass:a,blockSelector:i,maskTextClass:s,maskTextSelector:c,skipChild:l,inlineStylesheet:h,maskInputOptions:v,maskTextFn:y,maskInputFn:g,slimDOMOptions:b,dataURLOptions:S,inlineImages:x,recordCanvas:O,preserveWhiteSpace:G,onSerialize:E,onIframeLoad:I,iframeLoadTimeout:N,onStylesheetLoad:M,stylesheetLoadTimeout:j,keepIframeSrcFn:U},$=0,K=Array.from(t.childNodes);$<K.length;$++){(Z=A(K[$],Y))&&B.childNodes.push(Z)}if(function(t){return t.nodeType===t.ELEMENT_NODE}(t)&&t.shadowRoot)for(var J=0,X=Array.from(t.shadowRoot.childNodes);J<X.length;J++){var Z;(Z=A(X[J],Y))&&(p(t.shadowRoot)&&(Z.isShadow=!0),B.childNodes.push(Z))}}return t.parentNode&&function(t){var e=null==t?void 0:t.host;return Boolean((null==e?void 0:e.shadowRoot)===t)}(t.parentNode)&&p(t.parentNode)&&(B.isShadow=!0),B.type===f.Element&&"iframe"===B.tagName&&function(t,e,r){var n=t.contentWindow;if(n){var o,a=!1;try{o=n.document.readyState}catch(t){return}if("complete"===o){var i="about:blank";if(n.location.href!==i||t.src===i||""===t.src)return setTimeout(e,0),t.addEventListener("load",e);t.addEventListener("load",e)}else{var s=setTimeout((function(){a||(e(),a=!0)}),r);t.addEventListener("load",(function(){clearTimeout(s),a=!0,e()}))}}}(t,(function(){var e=t.contentDocument;if(e&&I){var r=A(e,{doc:e,mirror:o,blockClass:a,blockSelector:i,maskTextClass:s,maskTextSelector:c,skipChild:!1,inlineStylesheet:h,maskInputOptions:v,maskTextFn:y,maskInputFn:g,slimDOMOptions:b,dataURLOptions:S,inlineImages:x,recordCanvas:O,preserveWhiteSpace:G,onSerialize:E,onIframeLoad:I,iframeLoadTimeout:N,onStylesheetLoad:M,stylesheetLoadTimeout:j,keepIframeSrcFn:U});r&&I(t,r)}}),N),B.type===f.Element&&"link"===B.tagName&&"stylesheet"===B.attributes.rel&&function(t,e,r){var n,o=!1;try{n=t.sheet}catch(t){return}if(!n){var a=setTimeout((function(){o||(e(),o=!0)}),r);t.addEventListener("load",(function(){clearTimeout(a),o=!0,e()}))}}(t,(function(){if(M){var e=A(t,{doc:n,mirror:o,blockClass:a,blockSelector:i,maskTextClass:s,maskTextSelector:c,skipChild:!1,inlineStylesheet:h,maskInputOptions:v,maskTextFn:y,maskInputFn:g,slimDOMOptions:b,dataURLOptions:S,inlineImages:x,recordCanvas:O,preserveWhiteSpace:G,onSerialize:E,onIframeLoad:I,iframeLoadTimeout:N,onStylesheetLoad:M,stylesheetLoadTimeout:j,keepIframeSrcFn:U});e&&M(t,e)}}),j),B}var R=function(){return o((function t(e){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),i(this,"url","http://localhost:3000"),i(this,"info",{format:"jpeg"}),i(this,"responseText",""),i(this,"responseImageCode",""),i(this,"responseImageType",""),i(this,"responseImageSize",""),i(this,"dom",null),i(this,"rebuildDom",null),this.url=e||this.url}),[{key:"snapshot",value:(l=n(c().mark((function t(e,r){var n;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return Object.assign(this.info,e),o=window.document,a=void 0,i=void 0,s=void 0,c=void 0,u=void 0,l=void 0,d=void 0,f=void 0,p=void 0,h=void 0,m=void 0,y=void 0,g=void 0,b=void 0,k=void 0,w=void 0,S=void 0,T=void 0,x=void 0,L=void 0,O=void 0,E=void 0,I=void 0,C=void 0,N=void 0,M=void 0,_=void 0,j=void 0,D=void 0,F=void 0,R=void 0,i=(a=r||{}||{}).mirror,s=void 0===i?new v:i,c=a.blockClass,u=void 0===c?"rr-block":c,l=a.blockSelector,d=void 0===l?null:l,f=a.maskTextClass,p=void 0===f?"rr-mask":f,h=a.maskTextSelector,m=void 0===h?null:h,y=a.inlineStylesheet,g=void 0===y||y,b=a.inlineImages,k=void 0!==b&&b,w=a.recordCanvas,S=void 0!==w&&w,T=a.maskAllInputs,x=void 0!==T&&T,L=a.maskTextFn,O=a.maskInputFn,E=a.slimDOM,I=void 0!==E&&E,C=a.dataURLOptions,N=a.preserveWhiteSpace,M=a.onSerialize,_=a.onIframeLoad,j=a.iframeLoadTimeout,D=a.onStylesheetLoad,F=a.stylesheetLoadTimeout,R=a.keepIframeSrcFn,n=A(o,{doc:o,mirror:s,blockClass:u,blockSelector:d,maskTextClass:p,maskTextSelector:m,skipChild:!1,inlineStylesheet:g,maskInputOptions:!0===x?{color:!0,date:!0,"datetime-local":!0,email:!0,month:!0,number:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0,textarea:!0,select:!0,password:!0}:!1===x?{password:!0}:x,maskTextFn:L,maskInputFn:O,slimDOMOptions:!0===I||"all"===I?{script:!0,comment:!0,headFavicon:!0,headWhitespace:!0,headMetaDescKeywords:"all"===I,headMetaSocial:!0,headMetaRobots:!0,headMetaHttpEquiv:!0,headMetaAuthorship:!0,headMetaVerification:!0}:!1===I?{}:I,dataURLOptions:C,inlineImages:k,recordCanvas:S,preserveWhiteSpace:N,onSerialize:M,onIframeLoad:_,iframeLoadTimeout:j,onStylesheetLoad:D,stylesheetLoadTimeout:F,keepIframeSrcFn:void 0===R?function(){return!1}:R,newlyAddedElement:!1}),t.abrupt("return",this._sanp(n));case 3:case"end":return t.stop()}var o,a,i,s,c,u,l,d,f,p,h,m,y,g,b,k,w,S,T,x,L,O,E,I,C,N,M,_,j,D,F,R}),t,this)}))),function(t,e){return l.apply(this,arguments)})},{key:"snapshotAndDown",value:(r=n(c().mark((function e(r,n){var o,a;return c().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,this.snapshot(r,n);case 2:(o=e.sent).error?console.error(t(o.error.message)):(a=URL.createObjectURL(o),this._downloadUrl(a));case 4:case"end":return e.stop()}}),e,this)}))),function(t,e){return r.apply(this,arguments)})},{key:"_sendUrl",value:function(){var t={},e=[];return t=function(t){for(var e=1;e<arguments.length;e++){var r=null!=arguments[e]?arguments[e]:{};e%2?s(Object(r),!0).forEach((function(e){i(t,e,r[e])})):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):s(Object(r)).forEach((function(e){Object.defineProperty(t,e,Object.getOwnPropertyDescriptor(r,e))}))}return t}({},this.info),e=Object.keys(t).map((function(e){if(t[e])return Array.isArray(t[e])?t[e].map((function(t){return"".concat(e,"=").concat(encodeURIComponent(t))})).join("&"):"".concat(e,"=").concat(encodeURIComponent(t[e]))})).filter((function(t){return t})),"".concat(this.url,"/api/screenshot?").concat(e.join("&"))}},{key:"_downloadUrl",value:function(t){if(t){var e=document.createElement("a");e.href=t,e.download="image.".concat(this.info.format),document.body.appendChild(e),e.click(),URL.revokeObjectURL(t),e.remove()}}},{key:"_sanp",value:(e=n(c().mark((function t(e){var r,n=this;return c().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,window.fetch(this._sendUrl(),{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({html:"",rrwebsnapshot:e})}).then((function(t){n.responseImageCode=t.status,n.responseImageType=t.headers.get("content-type"),n.responseImageSize=parseInt(t.headers.get("content-length")/1e3);var e=[];e.push("status code: ".concat(t.status));var r,o=a(t.headers.entries());try{for(o.s();!(r=o.n()).done;){var i=u(r.value,2),s=i[0],c=i[1];console.log(s+": "+c),e.push(s+": "+c)}}catch(t){o.e(t)}finally{o.f()}return n.responseText=e.join("\n"),200===t.status?t.blob():t.json()})).catch((function(t){console.error(t)}));case 2:return r=t.sent,t.abrupt("return",r);case 4:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})}]);var e,r,l}();return R}));
